plugins {
    id 'org.jetbrains.intellij' version '0.6.4'
    id 'org.jetbrains.kotlin.jvm' version '1.5.21'
}

apply from: 'deps.gradle'

group GROUP
version VERSION_NAME

test {
    useJUnitPlatform()
}

repositories {
    maven {
        url 'https://www.jetbrains.com/intellij-repository/releases'
    }
    mavenCentral()
    google()
}

dependencies {
    implementation deps.kotlin.stdlib
    implementation deps.globallydynamic.server

    testImplementation deps.truth
    testImplementation deps.junit.api
    testImplementation deps.junit.params
    testImplementation deps.junit.engine
    testImplementation deps.junit.runner
}

compileKotlin {
    kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
    kotlinOptions.jvmTarget = "1.8"
}

intellij {
    plugins 'android'
    localPath "${System.getenv("ANDROID_STUDIO_PATH")}"
}

def instrumentCompilerVersion = "203.7717.56"

instrumentCode {
    compilerVersion = instrumentCompilerVersion
}

instrumentTestCode {
    compilerVersion = instrumentCompilerVersion
}

publishPlugin {
    // channels 'alpha'
    token project.hasProperty("intellijPublishToken") ? "${intellijPublishToken}" : ""
}

buildSearchableOptions.systemProperty("idea.is.internal", "")

patchPluginXml {
    // 1.0.0
//    changeNotes """
//      Compatible with Android Studio 4.0
//
//      <ul>
//        <li>Embedded GloballyDynamic server that apps using the <a href="https://github.com/jeppeman/GloballyDynamic/tree/master/globallydynamic-android-lib">GloballyDynamic Android library</a> can get their splits from</li>
//        <li>Tool window with a log from the server for debugging and visualization purposes</li>
//        <li>Action menu items to manually start/stop a server</li>
//        <li>Adds a step before running a bundle app that automatically starts the server</li>
//      <ul>
//
//      <p>Find the documentation <a href="https://globallydynamic.io">here</a></p>
//      """

    // 1.1.0
//    """
//    Android Studio 4.1 compatibility
//    """

    // 1.2.0
//    changeNotes """
//        Android Studio 4.2 compatibility
//    """

    // 1.3.0
    changeNotes """
    <ul>
        <li>Android Studio Arctic Fox (2020.3.1) compatibility</li>
        <li>Bumped GloballyDynamic Server to 1.1.0</li>
    </ul>
    """
}
